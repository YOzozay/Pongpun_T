import React, { useState, useMemo, useEffect } from 'react';
import { CheckCircle, Circle, Car, Calendar, DollarSign, TrendingUp, AlertCircle, Check } from 'lucide-react';

const App = () => {
  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  const TOTAL_INSTALLMENTS = 72;
  const AMOUNT_PER_MONTH = 12220;
  const TOTAL_LOAN = 879840;
  const START_DATE = new Date('2024-01-20'); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏ß‡∏î‡πÅ‡∏£‡∏Å 20 ‡∏°.‡∏Ñ. 67 ‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå CSV

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏á‡∏ß‡∏î 1-25 ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß, 26 ‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞)
  const generateInitialData = () => {
    const data = [];
    for (let i = 1; i <= TOTAL_INSTALLMENTS; i++) {
      const dueDate = new Date(START_DATE);
      dueDate.setMonth(START_DATE.getMonth() + (i - 1));

      // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      let status = 'pending';
      if (i <= 25) status = 'paid';
      
      data.push({
        id: i,
        installmentNo: i,
        dueDate: dueDate,
        amount: AMOUNT_PER_MONTH,
        status: status, // 'paid' or 'pending'
        isCurrent: i === 26
      });
    }
    return data;
  };

  const [installments, setInstallments] = useState(generateInitialData());

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
  const formatDateTH = (date) => {
    return date.toLocaleDateString('th-TH', {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
    });
  };

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('th-TH', {
      style: 'currency',
      currency: 'THB',
      minimumFractionDigits: 0
    }).format(amount);
  };

  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ
  const stats = useMemo(() => {
    const paidCount = installments.filter(i => i.status === 'paid').length;
    const paidAmount = paidCount * AMOUNT_PER_MONTH;
    const remainingAmount = TOTAL_LOAN - paidAmount;
    const progress = (paidAmount / TOTAL_LOAN) * 100;
    
    // ‡∏´‡∏≤‡∏á‡∏ß‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢
    const nextDue = installments.find(i => i.status === 'pending');

    return {
      paidCount,
      paidAmount,
      remainingAmount,
      progress,
      nextDue
    };
  }, [installments]);

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
  const togglePayment = (id) => {
    setInstallments(prev => prev.map(item => {
      if (item.id === id) {
        return { ...item, status: item.status === 'paid' ? 'pending' : 'paid' };
      }
      return item;
    }));
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-12">
      {/* Header */}
      <header className="bg-gradient-to-r from-blue-700 to-blue-900 text-white shadow-lg sticky top-0 z-20">
        <div className="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="bg-white/20 p-2 rounded-full backdrop-blur-sm">
              <Car className="w-6 h-6" />
            </div>
            <div>
              <h1 className="text-lg font-bold leading-tight">Car Loan Tracker</h1>
              <p className="text-xs text-blue-200">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</p>
            </div>
          </div>
          <div className="text-right hidden sm:block">
            <p className="text-xs opacity-80">‡∏¢‡∏≠‡∏î‡∏Å‡∏π‡πâ‡∏£‡∏ß‡∏°</p>
            <p className="font-bold">{formatCurrency(TOTAL_LOAN)}</p>
          </div>
        </div>
      </header>

      <main className="max-w-5xl mx-auto px-4 pt-6 space-y-6">
        
        {/* Dashboard Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {/* Card 1: Paid */}
          <div className="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 flex flex-col justify-between relative overflow-hidden">
            <div className="absolute top-0 right-0 p-4 opacity-10">
              <CheckCircle className="w-16 h-16 text-emerald-500" />
            </div>
            <div>
              <p className="text-sm text-slate-500 font-medium mb-1">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</p>
              <h2 className="text-3xl font-bold text-emerald-600">{formatCurrency(stats.paidAmount)}</h2>
            </div>
            <div className="mt-4 flex items-center gap-2 text-sm text-slate-600 bg-emerald-50 w-fit px-3 py-1 rounded-full">
              <Check className="w-4 h-4 text-emerald-600" />
              <span>{stats.paidCount} / {TOTAL_INSTALLMENTS} ‡∏á‡∏ß‡∏î</span>
            </div>
          </div>

          {/* Card 2: Remaining */}
          <div className="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 flex flex-col justify-between relative overflow-hidden">
             <div className="absolute top-0 right-0 p-4 opacity-10">
              <DollarSign className="w-16 h-16 text-rose-500" />
            </div>
            <div>
              <p className="text-sm text-slate-500 font-medium mb-1">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
              <h2 className="text-3xl font-bold text-rose-600">{formatCurrency(stats.remainingAmount)}</h2>
            </div>
            <div className="mt-4 flex items-center gap-2 text-sm text-slate-600 bg-rose-50 w-fit px-3 py-1 rounded-full">
              <TrendingUp className="w-4 h-4 text-rose-600" />
              <span>‡∏≠‡∏µ‡∏Å {TOTAL_INSTALLMENTS - stats.paidCount} ‡∏á‡∏ß‡∏î</span>
            </div>
          </div>

           {/* Card 3: Next Due */}
           <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-5 shadow-md text-white flex flex-col justify-between">
            <div>
              <p className="text-sm text-indigo-100 font-medium mb-1 flex items-center gap-1">
                <Calendar className="w-4 h-4" /> ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏á‡∏ß‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
              </p>
              {stats.nextDue ? (
                <>
                  <h2 className="text-2xl font-bold mt-2">{formatDateTH(stats.nextDue.dueDate)}</h2>
                  <p className="text-indigo-100 mt-1">‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà {stats.nextDue.installmentNo}</p>
                </>
              ) : (
                <div className="h-full flex items-center">
                  <span className="text-xl font-bold">‡∏ú‡πà‡∏≠‡∏ô‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß! üéâ</span>
                </div>
              )}
            </div>
            {stats.nextDue && (
              <div className="mt-4 bg-white/20 backdrop-blur-sm rounded-lg p-2 text-center">
                <span className="font-bold">{formatCurrency(AMOUNT_PER_MONTH)}</span>
              </div>
            )}
          </div>
        </div>

        {/* Progress Bar Section */}
        <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100">
          <div className="flex justify-between items-end mb-2">
            <div>
              <h3 className="font-bold text-slate-800 text-lg">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞</h3>
              <p className="text-sm text-slate-500">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤‡πÑ‡∏î‡πâ {stats.progress.toFixed(1)}% ‡πÅ‡∏•‡πâ‡∏ß</p>
            </div>
            <span className="text-2xl font-bold text-blue-600">{stats.progress.toFixed(0)}%</span>
          </div>
          <div className="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
            <div 
              className="bg-gradient-to-r from-blue-500 to-emerald-400 h-full rounded-full transition-all duration-500 ease-out shadow-[0_0_10px_rgba(59,130,246,0.5)]"
              style={{ width: `${stats.progress}%` }}
            ></div>
          </div>
        </div>

        {/* Installment List */}
        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
          <div className="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
            <h3 className="font-bold text-slate-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô ({TOTAL_INSTALLMENTS} ‡∏á‡∏ß‡∏î)</h3>
          </div>
          
          <div className="divide-y divide-slate-100">
            {installments.map((item) => (
              <div 
                key={item.id} 
                className={`group flex items-center justify-between p-4 hover:bg-slate-50 transition-colors ${item.isCurrent && item.status !== 'paid' ? 'bg-amber-50 hover:bg-amber-100' : ''}`}
              >
                {/* Left: Info */}
                <div className="flex items-center gap-4">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-sm
                    ${item.status === 'paid' 
                      ? 'bg-emerald-100 text-emerald-700' 
                      : (item.isCurrent ? 'bg-amber-500 text-white' : 'bg-slate-100 text-slate-500')}
                  `}>
                    {item.installmentNo}
                  </div>
                  <div>
                    <div className="flex items-center gap-2">
                      <p className={`font-semibold ${item.status === 'paid' ? 'text-slate-600' : 'text-slate-900'}`}>
                        {formatDateTH(item.dueDate)}
                      </p>
                      {item.isCurrent && item.status !== 'paid' && (
                        <span className="text-[10px] bg-amber-500 text-white px-2 py-0.5 rounded-full">
                          ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                        </span>
                      )}
                    </div>
                    <p className="text-sm text-slate-500">{formatCurrency(item.amount)}</p>
                  </div>
                </div>

                {/* Right: Action */}
                <button
                  onClick={() => togglePayment(item.id)}
                  className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-200 border
                    ${item.status === 'paid'
                      ? 'bg-emerald-500 border-emerald-500 text-white shadow-emerald-200'
                      : 'bg-white border-slate-200 text-slate-400 hover:border-emerald-500 hover:text-emerald-500'}
                  `}
                >
                  {item.status === 'paid' ? (
                    <>
                      <CheckCircle className="w-5 h-5" />
                      <span className="hidden sm:inline font-medium">‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</span>
                    </>
                  ) : (
                    <>
                      <Circle className="w-5 h-5" />
                      <span className="hidden sm:inline">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</span>
                    </>
                  )}
                </button>
              </div>
            ))}
          </div>
        </div>
      </main>
    </div>
  );
};

export default App;
