<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Kanit', sans-serif; }
  </style>
</head>

<body class="bg-gray-50 min-h-screen p-6">

<div class="max-w-4xl mx-auto">
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-3xl font-bold text-gray-800">‡πÑ‡∏ó‡∏°‡πå‡πÑ‡∏•‡∏ô‡πå‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô</h1>
    <span id="loading-status" class="text-sm text-blue-500 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
  </div>

  <div id="installments" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
</div>

<script>
// ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì Deploy ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
const API_URL = "https://script.google.com/macros/s/AKfycbzTpDyH-yPWVluGhj2sgQg8tR1oGuSsy382VyVfrvPKxtEXZhiPmWL2afULTC8LA6N_gA/exec";

document.addEventListener("DOMContentLoaded", function () {
  fetch(API_URL)
    .then(res => {
      if (!res.ok) throw new Error("Network response was not ok");
      return res.json();
    })
    .then(data => {
      console.log("‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:", data);
      document.getElementById("loading-status").classList.add("hidden");
      render(data);
    })
    .catch(err => {
      console.error("FETCH ERROR:", err);
      document.getElementById("loading-status").innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î";
      document.getElementById("installments").innerHTML = `
        <div class='col-span-full text-center p-10 bg-red-50 text-red-600 rounded-xl border border-red-200'>
          ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Deployment ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        </div>`;
    });
});

function render(data) {
  const container = document.getElementById("installments");
  container.innerHTML = "";

  if (!data || data.length === 0) {
    container.innerHTML = "<div class='text-gray-500'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô</div>";
    return;
  }

  data.forEach(row => {
    // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Apps Script: [no, date, amount, status, note]
    const no = row[0] || "-";
    const date = row[1] || "-"; // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á split("T") ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ù‡∏±‡πà‡∏á Apps Script ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß
    const amount = typeof row[2] === 'number' ? row[2] : 0;
    const status = row[3] ? row[3].trim() : "";

    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    let bgClass = "bg-white border-gray-200";
    let badgeHtml = "";

    if (status === "‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß") {
      bgClass = "bg-green-50 border-green-200";
      badgeHtml = `
        <div class="bg-green-500 text-white rounded-full p-1 w-8 h-8 flex items-center justify-center shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
        </div>`;
    }

    container.innerHTML += `
      <div class="p-5 rounded-2xl border ${bgClass} shadow-sm flex justify-between items-center transition hover:shadow-md">
        <div>
          <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1">‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà ${no}</div>
          <div class="text-sm font-medium text-gray-600 mb-1">üìÖ ${date}</div>
          <div class="text-xl font-bold text-gray-800">‡∏ø${amount.toLocaleString()}</div>
        </div>
        <div>
          ${badgeHtml}
        </div>
      </div>
    `;
  });
}
</script>

</body>
</html>
